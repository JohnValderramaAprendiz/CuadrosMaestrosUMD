<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum - Cuadros Maestros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Work Sans', sans-serif;
            --uniminuto-blue: #00205B;
            --uniminuto-yellow: #FFC72C;
            --uniminuto-gray: #75787B;
            background-color: #f4f6f9;
            color: #333;
        }
        h1, h2, h3, h4, h5, h6, .font-header {
            font-family: 'Poppins', sans-serif;
        }
        .header-link.active {
            color: var(--uniminuto-blue);
            font-weight: 700;
        }
        .card {
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 32, 91, 0.1);
        }
        .btn-primary {
            background-color: var(--uniminuto-yellow);
            color: var(--uniminuto-blue);
            font-weight: bold;
            transition: background-color 0.3s, transform 0.3s;
        }
        .btn-primary:hover {
            background-color: #ffd966;
            transform: scale(1.05);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4a5568;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <header class="bg-white z-20 sticky top-0 border-b border-gray-200">
        <div class="container mx-auto flex justify-between items-center h-20 px-6">
            <div class="flex items-center gap-4">
                <span class="text-3xl font-extrabold text-[var(--uniminuto-blue)] font-header">Quantum</span>
            </div>
            <nav class="hidden md:flex items-center gap-8 text-[var(--uniminuto-gray)] font-semibold">
                <a href="/" class="header-link hover:text-[var(--uniminuto-blue)] transition-colors">Inicio</a>
                <a href="/plantillas" class="header-link active hover:text-[var(--uniminuto-blue)] transition-colors">Cuadros Maestros</a>
                <a href="/instructivo" class="header-link hover:text-[var(--uniminuto-blue)] transition-colors">Instructivo</a>
                <a href="/repositorio" class="header-link hover:text-[var(--uniminuto-blue)] transition-colors">Repositorio</a>
            </nav>
        </div>
    </header>
    <main class="flex-grow py-16 bg-gray-200">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-10">
                Genera tus Cuadros Maestros
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 max-w-7xl mx-auto">
                <div class="card p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">CM 1 - Identificación</h3>
                        <p class="text-gray-600 text-sm mb-4">Información general del programa académico, incluyendo datos institucionales, promociones y graduados.</p>
                    </div>
                    <button onclick="openModal(1, 'CM 1 - Identificación')" class="btn-primary w-full py-2 px-4 rounded-lg shadow-md mt-4">Generar</button>
                </div>
                <div class="card p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">CM 3 - Profesores</h3>
                        <p class="text-gray-600 text-sm mb-4">Reporte detallado de profesores por dedicación (TC, MT, TP) y categorías académicas del programa.</p>
                    </div>
                    <button onclick="openModal(3, 'CM 3 - Profesores')" class="btn-primary w-full py-2 px-4 rounded-lg shadow-md mt-4">Generar</button>
                </div>
                <div class="card p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">CM 9 - Prácticas</h3>
                        <p class="text-gray-600 text-sm mb-4">Reporte consolidado de las prácticas académicas y modalidades de vinculación de los estudiantes.</p>
                    </div>
                    <button onclick="openModal(9, 'CM 9 - Prácticas')" class="btn-primary w-full py-2 px-4 rounded-lg shadow-md mt-4">Generar</button>
                </div>
                <div class="card p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">CM 10 - Proyección Social</h3>
                        <p class="text-gray-600 text-sm mb-4">Registro detallado de proyectos de extensión y proyección social con coordinadores, beneficiarios y alcance.</p>
                    </div>
                    <button onclick="openModal(10, 'CM 10 - Proyección Social')" class="btn-primary w-full py-2 px-4 rounded-lg shadow-md mt-4">Generar</button>
                </div>
                <div class="card p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">CM 20 - Becas, subsidios, descuentos y patrocinios</h3>
                        <p class="text-gray-600 text-sm mb-4">Informe detallado sobre los apoyos financieros otorgados a estudiantes por concepto de becas, subsidios y patrocinios.</p>
                    </div>
                    <button onclick="openModal(20, 'CM 20 - Becas, subsidios, descuentos y patrocinios')" class="btn-primary w-full py-2 px-4 rounded-lg shadow-md mt-4">Generar</button>
                </div>
            </div>
        </div>
    </main>
    <div id="reportModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeModal()">&times;</button>
            <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Generar Reporte</h3>
            <form id="modalReportForm" class="space-y-6">
                <div>
                    <label for="modalPlantillaName" class="block text-gray-700 text-sm font-bold mb-2">
                        Plantilla Seleccionada:
                    </label>
                    <input type="text" id="modalPlantillaName" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight bg-gray-100 cursor-not-allowed" readonly>
                    <input type="hidden" id="modalPlantillaId" name="plantilla">
                </div>
                <div>
                    <label for="modalCodigo" class="block text-gray-700 text-sm font-bold mb-2">
                        Código de Programa (SNIES/Código):
                        <span class="text-xs text-gray-500">(Ej. 91237 o 2052)</span>
                    </label>
                    <input type="number" id="modalCodigo" name="codigo" placeholder="Ingrese el código aquí" required
                        class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" id="modalGenerateBtn"
                    class="btn-primary w-full py-3 px-4 rounded-lg shadow-md">
                    Generar y Descargar Reporte
                </button>
            </form>
            <div id="modalMessageArea" class="mt-6 p-4 rounded-lg text-center hidden">
                <p id="modalMessageText" class="font-medium"></p>
            </div>
        </div>
    </div>
    <footer class="bg-gray-100 text-[var(--uniminuto-gray)] mt-12 border-t">
        <div class="container mx-auto py-6 px-6 text-center">
            <p class="font-bold text-sm text-[var(--uniminuto-blue)]">Quantum - UNIMINUTO Corporación Universitaria Minuto de Dios</p>
            <p class="text-xs">Educación de calidad al alcance de todos</p>
        </div>
    </footer>
    <script>
        // Modal y generación de reportes
        let selectedPlantillaId = null;
        document.getElementById('modalReportForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const plantilla = document.getElementById('modalPlantillaId').value;
            const codigo = document.getElementById('modalCodigo').value;
            const modalGenerateBtn = document.getElementById('modalGenerateBtn');
            const modalMessageArea = document.getElementById('modalMessageArea');
            const modalMessageText = document.getElementById('modalMessageText');
            if (!plantilla || !codigo) {
                showModalMessage('Por favor, complete el código del programa.', 'bg-red-100 text-red-700');
                return;
            }
            modalGenerateBtn.disabled = true;
            modalGenerateBtn.textContent = 'Generando... por favor espere';
            showModalMessage('Generando su reporte, por favor espere...', 'bg-blue-100 text-blue-700');
            try {
                const response = await fetch('http://127.0.0.1:5000/generar_reporte', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ plantilla: parseInt(plantilla), codigo: parseInt(codigo) })
                });
                if (response.ok) {
                    const contentDisposition = response.headers.get('Content-Disposition');
                    let filename = 'reporte_generado.xlsx';
                    if (contentDisposition) {
                        const match = contentDisposition.match(/filename="([^"]+)"/);
                        if (match && match[1]) filename = match[1];
                    }
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);
                    showModalMessage(`¡Reporte "${filename}" generado y descargado con éxito!`, 'bg-green-100 text-green-700');
                } else {
                    const errorData = await response.json();
                    showModalMessage(`Error al generar el reporte: ${errorData.error || 'Error desconocido'}`, 'bg-red-100 text-red-700');
                }
            } catch (error) {
                showModalMessage('No se pudo conectar con el servidor. Asegúrate de que la API Flask esté corriendo en http://127.0.0.1:5000.', 'bg-red-100 text-red-700');
            } finally {
                modalGenerateBtn.disabled = false;
                modalGenerateBtn.textContent = 'Generar y Descargar Reporte';
            }
        });
        function openModal(id, name) {
            document.getElementById('modalPlantillaName').value = name;
            document.getElementById('modalPlantillaId').value = id;
            document.getElementById('modalCodigo').value = '';
            document.getElementById('modalMessageArea').classList.add('hidden');
            document.getElementById('reportModal').classList.remove('hidden');
        }
        function closeModal() {
            document.getElementById('reportModal').classList.add('hidden');
            document.getElementById('modalGenerateBtn').disabled = false;
            document.getElementById('modalGenerateBtn').textContent = 'Generar y Descargar Reporte';
            document.getElementById('modalMessageArea').classList.add('hidden');
        }
        function showModalMessage(msg, typeClass) {
            const area = document.getElementById('modalMessageArea');
            const text = document.getElementById('modalMessageText');
            area.className = 'mt-6 p-4 rounded-lg text-center ' + typeClass;
            text.textContent = msg;
            area.classList.remove('hidden');
        }
    </script>
</body>
</html> 